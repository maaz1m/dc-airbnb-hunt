---
title: "D.C. Airbnb Hunt"
author: "Foo Fivers"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
    toc: true
    number_sections: true

---

```{r, echo = FALSE, results = 'hide', message = FALSE}
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(readr)
library(plyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(leaflet)
library(tidytext)
library(stringr)
library(wordcloud)
library(ezids)
knitr::opts_chunk$set(warning = FALSE, echo=FALSE, results='hide')
```

# Introduction

As travel continues to open up across the world, more travelers are exploring locations they are unfamiliar with. Lodging is a crucial, yet complicated decision to make when traveling to a new location. There are many factors to take into consideration, and they all come at a cost. The gig economy has opened up more opportunities for travelers as private homeowners are able to provide a more customized experience at a competitive price compared to major hotel chains.

Airbnb is a hotel competitor, which provides lodging for visitors in predominantly privately owned residences. According to the statistical data posted by ipropertymanagement, the general price of Airbnb listings in Europe is about 8%-17% cheaper than the hotels, while the percentage is 6% - 17% cheaper in the United States (paragraph 4). These statistics show that Airbnb could be an option that is economically better than traditional hotels.

Airbnbs tend to offer a diverse experience, for better or for worse. Due to this variety, ratings have become an important factor when placing a booking. So what do Airbnb users usually rate on? In Mingming Chen and Xin Jin’s paper of “What do Airbnb users care about? An analysis of online review comments”, they suggest the Airbnb users may rate and comment on their experiences with the similar accommodation standards of location, amenities, and host for valuing hotels but in different order of importance (Paragraph 58). Therefore, these aggregated user ratings signal to future users the quality of stay over a variety of factors, such as location, accessibility, cleanliness, accuracy, value, etc.

Travelers looking through an Airbnb website or app may have hundreds of options to choose from depending on their preferences and locality. Narrowing it down to just one Airbnb rental could be a painstaking process of research and comparison. Exploring the dataset of all listings in a locality such as DC, can provide a better understanding of the crucial decision-making KPI of listing rating, as well as give insight to travelers about how to best subset or limit their vacation rental search.

# SMART Questions

To provide greater insights for travelers looking to book an Airbnb in DC, we will be utilizing the DC Airbnb listing data to identify the neighborhoods within DC that provide the best overall value properties (highest rating at the lowest price). This will be our primary SMART question. Furthermore, we will also analyze additional factors to look for in a listing to ensure a high-quality visit to the district. For example, we would like to discover the influence of room type in the decision of neighborhoods. In addition, we are interested in how listing names posted by the hosts affect their Airbnbs’ values.

# Dataset

```{r, echo = FALSE}
df <- read.csv('listings_detailed.csv')
```

The raw data is obtained from Inside Airbnb, an open-source data tool providing the web scraped Airbnb listing information by cities. It includes `r nrow(df)` records with `r ncol(df)` data columns in total size. Below are all of the data columns.
  
```{r, echo = FALSE, results = 'markup'}
colnames(df)
```

```{r, echo=FALSE}
df <- df %>% 
  dplyr::select(id, name, host_is_superhost, host_listings_count, neighbourhood_cleansed, latitude, longitude, room_type, bedrooms, beds, amenities, price, availability_60, number_of_reviews, review_scores_rating,  review_scores_accuracy, review_scores_cleanliness,
            review_scores_checkin, review_scores_communication, review_scores_location, review_scores_value, reviews_per_month) %>% 
  dplyr::mutate(price = as.numeric(parse_number(price)),
         neighbourhood_cleansed = as.factor(neighbourhood_cleansed),
         amenities = lengths(strsplit((str_sub(df$amenities, 2, -2)), ",")),
         room_type = as.factor(room_type),
         bedrooms = as.factor(bedrooms)) %>%
  dplyr::rename(neighbourhood = neighbourhood_cleansed)
df = na.omit(df)
```
  
We then preprocessed this raw dataset by selecting specific data columns and converting the datatypes of some columns. Eventually, the cleaned dataset has `r ncol(df)` records with `r nrow(df)` columns after column renaming and NA removal.

```{r, echo = FALSE, results='markup'}
#pretty output for presentation
data.frame(variable = names(df),
           classe = sapply(df, typeof),
           first_values = sapply(df, function(x) paste0(head(x,2),  collapse = ", ")),
           row.names = NULL) %>% 
  kable()
```

# Descriptive statistics

We first inspected the normality of the data columns like price, number of reviews, review rating scores, amenities, and reviews per month by generating the histograms and Q-Q plots for each of them. All distribution plots are made without including the possible outliers.

## Histogram and QQ plot for Price

The histogram of price shows a slight tendency of right skewness with the majority of prices in the range of $75-$100. Meanwhile, its Q-Q plot indicates that some points are a bit away from the normality line.

```{r, fig.show='hide'}
Price_No_Outlier = outlierKD2(df, price, rm=TRUE)
```

```{r, results = 'markup'}
par(mfrow = c(1,2))
hist(Price_No_Outlier$price, main = 'Histogram of Price', xlim = c(0,350))
qqnorm(Price_No_Outlier$price, main="Q-Q plot of Price")
qqline(Price_No_Outlier$price)
```

## Histogram and QQ plot for Number of Reviews

The histogram of the Number of Reviews shows a steep right skewness with the majority of less than 30. We can also see that half of the points are off the trace of the normality line.

```{r, fig.show='hide'}
Number_of_Reviews_No_Outlier = outlierKD2(df, number_of_reviews, rm=TRUE)
```

```{r, results='markup'}
par(mfrow = c(1,2))
hist(Number_of_Reviews_No_Outlier$number_of_reviews, main = 'Histogram of Number of Reviews', xlim = c(0,200))
qqnorm(Number_of_Reviews_No_Outlier$number_of_reviews, main="Q-Q plot of Number of Reviews")
qqline(Number_of_Reviews_No_Outlier$number_of_reviews)
```

## Histogram and QQ plot for Amenities

Amenities have a fairly good bell shape in the histogram, indicating that it is close to a normal distribution. This means most Airbnb listings have 30-35 amenities. The Q-Q plot has a perfect trace of points following along the normality line.

```{r, fig.show='hide'}
Number_of_Amenities_No_Outlier = outlierKD2(df, amenities, rm=TRUE)
```

```{r, results='markup'}
par(mfrow = c(1,2))
hist(Number_of_Amenities_No_Outlier$amenities, main = 'Histogram of Amenities', xlim = c(0,65))
qqnorm(Number_of_Amenities_No_Outlier$amenities, main="Q-Q plot of Amenities")
qqline(Number_of_Amenities_No_Outlier$amenities)
```

## Histogram and QQ plot for Review Scores

The review rating scores tend to give a histogram with obvious left skewness. The possible reason should be the scale since many scores are within the range of 4.7-5.0, resulting in the high-frequency bins close to 5.0. In the Q-Q plot, a portion of the points is laying horizontally at 5.0 while other points are sticking to the normality line.


```{r, fig.show='hide'}
Number_of_review_scores_rating_No_Outlier = outlierKD2(df, review_scores_rating, rm=TRUE)
```

```{r, results='markup'}
par(mfrow = c(1,2))
hist(Number_of_review_scores_rating_No_Outlier$review_scores_rating, main = 'Histogram of Review Scores', xlim = c(4,6))
qqnorm(Number_of_review_scores_rating_No_Outlier$review_scores_rating, main="Q-Q plot of Review scores")
qqline(Number_of_review_scores_rating_No_Outlier$review_scores_rating)
```

## Histogram and QQ plot for Reviews per Month

Column of reviews per month produces similar results with the number of reviews. The right-skewed histogram shows the majority of less than 1 review per month, yet many points are close to the normality line.

```{r, fig.show='hide'}
Number_of_reviews_per_month_No_Outlier = outlierKD2(df, reviews_per_month, rm=TRUE)
```

```{r, results = 'markup'}
par(mfrow = c(1,2))
hist(Number_of_reviews_per_month_No_Outlier$reviews_per_month, main = 'Histogram of Reviews per Month', xlim = c(0,10))
qqnorm(Number_of_reviews_per_month_No_Outlier$reviews_per_month, main="Q-Q plot of Reviews per Month")
qqline(Number_of_reviews_per_month_No_Outlier$reviews_per_month)
```

From the plots of the columns like price and number of reviews, they may not be quite normal because skewness was found in some of their histograms and Q-Q points were a bit off the normality line. Amenities has the best overall performance among them.

We have made a few initial assumptions about these phenomena. For instance, the number of reviews would be heavily dependent on the guests’ motivation of leaving comments. Airbnb does not prompt a guest to leave a review but only the rating scores, so some guests may forget or purely do not want to leave a comment review. Most of the listings would provide the main amenities related to internet, bathroom, and kitchen; therefore, they should provide the amenities in similar numbers. The skewness of reviews per month is not surprising because of covid outbreak and decrease in travel while the skewness of rating scores shows a tendency to approve the hosts’ listings. Then the price may be affected by locations and accessibilities. 

# Exploratory Data Analysis
## Overview of Room Type and Neighborhood

Airbnb offers four types of rooms in the District of Columbia. This includes the entire place, a rental occupied fully by the renter with a private bathroom, bedroom and living space, private room, a rental where the renter has a private bedroom but may share other living spaces, shared room, a rental where the renter will share all living space, including the bedroom, and hotel room., a rental where visitors stay in a hotel room in a hostel or boutique hotel setting. Looking at the pie chart below, you will see that we found in DC the primary type of rental available was the entire place with private room following behind it. We found that a small proportion of listings is hotels or shared rooms. Each listing can only be one type of rental, and there can be no rentals with no room type, so we so no overlaps or nulls.

```{r, results='markup'}
d = as.data.frame(table(df$room_type))
group.colors = c("Entire home/apt" ="#51c5ed","Shared room"="#C3EB78","Private room"="#ff616f","Hotel room"="#3D348B")
ggplot(d, aes(y = Freq, x = "", fill = Var1)) + geom_bar(width=3, stat = "identity")+ coord_polar("y", start = 0)  + labs(title = "DC AirBnB Pie Chart of Room Types", x = "", y = "")+ 
  theme(
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),legend.position="right")+
        scale_fill_manual(values=group.colors)+
        labs(fill = "Room Type")
```

We will now split this out by neighborhood to see where there is the greatest selection of AirBnB units in the district. DC has 39 separate neighborhoods defined by Airbnb in our original dataset. In the frequency plot below, the total numbers of all Airbnb listings are shown. This shows us that DC Airbnbs are not evenly distributed across the district and there are a handful of neighborhoods with a high frequency of Airbnbs while most have less than 100 listings.

```{r, results='markup'}
#create column for neighborhood name in visualizations
df$neighbourhood_short <- str_sub(df$neighbourhood,1,15)
#add in column for frequency of listings
df_freq <- merge(df, data.frame(table(neighbourhood = df$neighbourhood)), by = c("neighbourhood"))
#create barplot of airbnb frequency by DC neighborhoods
ggplot(df_freq,aes(x=reorder(neighbourhood_short, neighbourhood_short, function(x)-length(x))))+geom_bar(aes(fill = room_type), alpha=.9)+ theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),legend.position="top")+
        scale_fill_manual(values=group.colors)+
        labs(fill = "Room Type", x="Neighborhood", y="# of AirBnBs Listed")+
        ggtitle("Frequency of AirBnBs by Neighborhood and Room Type") 
#v = as.data.frame(table(df$neighbourhood))
#v1 = v %>% slice(1:20)
#v2 = v %>% slice(21:50)
#par(mfrow = c(1,2))
#barplot(v1$Freq, main = "Barplot of Neighborhood Counts P1", ylab = "Count",  width = 5, names.arg = v1$Var1, las = 2, cex.names=0.6, col = 'darkred')
#barplot(v2$Freq, main = "Barplot of Neighborhood Counts P2", ylab = "Count",  width = 5, names.arg = v2$Var1, las = 2, cex.names=0.6, col = 'lightblue')
```
```{r}
#subset data where frequency is greater than 175
df_175 <-  df_freq[ which(df_freq$Freq>175), ]

#str(df_175)
means_df <- df_175 %>%
  group_by(neighbourhood_short,neighbourhood) %>%
  summarise_at(vars(c(price,review_scores_rating, Freq, latitude,longitude)), funs(mean(., na.rm=TRUE)))
means_df_rt <- df_175 %>%
  group_by(neighbourhood_short,neighbourhood,room_type) %>%
  summarise_at(vars(c(price,review_scores_rating, Freq, latitude,longitude)), funs(mean(., na.rm=TRUE)))
```

## Price and Room Type
Price is a key determinant for booking a listing. To understand how a listing may be selected, we tested to see if variation in price was significantly different by room type. We will plot average price by room type. As we saw in the summary statistics, there is a large spread on this data. So, we will be viewing these plots zoomed in to the 0 - 95th percentile. We first created a box plot to see the distribution of price by room type. In the figure below, there is a price for privacy. The entire place visibly has a higher distribution of price followed by private rooms, hotel rooms, and shared rooms. It should be noted that we can see there is minimal data available for hotels and shared rooms, so it is difficult to define definite conclusions for them compared to the entire place and private room. After that, a descending rank list of mean price across room types is given. The entire place has the highest average price compared to the other three prices. However, we will move forward with them for the sake of this analysis. 

```{r, results='markup'}
ggplot(df,aes(x=room_type, y=price))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = quantile(df$price, c(0.0, .95)))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=room_type))+
  theme(axis.text.x = element_text(angle = 90, size=10))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        scale_colour_manual(values=group.colors)+
        labs( x="Room Type", y="Price")+
        ggtitle("Box Plot of Price Distribution by Room Type")
```
```{r, results='markup'}
price_room = df %>%
  group_by(room_type) %>%
  summarise_at(vars(price), list(price = mean))
price_room = data.frame(price_room)
price_room[order(-rank(price_room$price), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

To confirm the trends we see in the boxplot, we ran an ANOVA to test the hypothesis that if there was a significant difference in the means of price across room types. Our result shows the p-value, less than 0.05, is close to 0, meaning we can reject the null hypothesis and conclude that there is a statistically significant difference in price across room types. 
```{r results = 'markup'}
#anova test to compare mean price
anovaRes_price2 <-  aov(price ~ room_type, data=means_df_rt)
xkabledply(anovaRes_price2, title = "Price by Room Type ANOVA")
```

## Review Rating Score and Room Type
We did the same analysis for review rating score as we did for price across room types. This time we would zoom from the 1st to 100th percentile. We first created a box plot to visually show the difference between the ratings by room type. We see here that the entire place has a slighter higher spread than the private room which has a higher spread than the shared room and the hotel room. The average review rating score of entire place listings is higher than the other three, yet the difference between entire place and private is much smaller than the difference between private room and hotel room.

```{r, results='markup'}
ggplot(df,aes(x=room_type, y=review_scores_rating))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = quantile(df$review_scores_rating, c(.01, 1)))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=room_type))+
  theme(axis.text.x = element_text(angle = 90, size=10))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        scale_colour_manual(values=group.colors)+
        labs( x="Room Type", y="Rating")+
        ggtitle("Box Plot of Rating Distribution by Room Type")
```
```{r, results='markup'}
rating_room = df %>%
  group_by(room_type) %>%
  summarise_at(vars(review_scores_rating), list(review_scores_rating = mean))
rating_room = data.frame(rating_room)
rating_room[order(-rank(rating_room$review_scores_rating), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

To further examine the trends we have identified in our boxplot, we again ran an ANOVA where we tested against our hypothesis of the review rating score and room type. Our results show a p-value of 0.0992, which allows us to conclude there we cannot reject the null hypothesis. The review rating score is not too significantly different among the room types.
```{r results = 'markup'}
#anova test to compare mean rating
anovaRes_rating2 <-  aov(review_scores_rating ~ room_type, data=means_df_rt)
xkabledply(anovaRes_rating2, title = "Rating by Room Type ANOVA")
```

## Price and Neighbourhood

To look at only the neighborhoods with a large amount of Airbnb listings to compare, we used the descending rank of counts of each neighborhood’s Airbnb listings from the frequency plot in the overview above, and pulled the top 10 neighborhoods, where each neighborhood’s listing frequency is greater than 175.

Looking across the entire dataset and in our subset of top 10 neighborhoods with the highest frequency of Airbnb listings, we find that the proportion of room type does not vary much across the neighborhoods. All neighborhoods are made up predominantly of entire places with some share of private rooms. In our subset, we do see two neighborhoods with hotels (Dupont Circle, Capitol Hill) and five neighborhoods with shared rooms (Capitol Hill, Columbia Heights, Dupont Circle, Shaw/Logan Circle, Kalorama Heights).

To see if Airbnb listings vary by price, zooming in to view the 0th to 95th percentile, we created a box plot to show the distribution of Airbnb listing prices across our ten neighborhoods. Displayed below, we see these neighborhoods not only look to have varying means but also varying spreads, suggesting that the price of an Airbnb will be different depending on the selected neighborhood. The ranking of average prices of neighborhoods tells us the highest is in areas like Downtown and Chinatown.

```{r, results='markup'}
ggplot(df_175,aes(x=neighbourhood_short, y=price))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = quantile(df$price, c(.0, .95)))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=neighbourhood_short))+
  theme(axis.text.x = element_text(angle = 90, size=9))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        labs( x="Neighborhood", y="Price")+
        ggtitle("Box Plot of Price Distribution by Neighborhood")
```

```{r, results='markup'}
price_neighbor = df_175 %>%
  group_by(neighbourhood) %>%
  summarise_at(vars(price), list(price = mean))
price_neighbor = data.frame(price_neighbor)
price_neighbor[order(-rank(price_neighbor$price), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

To confirm the trend we have identified in our boxplot, we again ran an ANOVA where we tested against our hypothesis that there was no significant difference between the mean price across DC neighborhoods. Our result shows a p-value of 6*10^(-4), allowing us to conclude there is a significant difference between prices by neighborhood.
```{r results = 'markup'}
#anova test to compare mean price
anovaRes_price1 <-  aov(price ~ neighbourhood, data=df_175)
xkabledply(anovaRes_price1, title = "Price by Neighborhood ANOVA")
```

## Review Rating Score and Neighbourhood

Next we will look at rating across neighborhoods. To better view this graph, we will be zooming in to view the 3rd to 100th percentile. We ran the same analysis for review rating score as we did for price across neighborhoods. We started by looking at a boxplot to examine the distribution of review rating scores across neighborhoods. We don’t see as much variation in this boxplot as we did for the price, as all tend to skew towards the highest ranking of 5. A descending rank list of mean price across the neighborhoods is given. From the list of average review rating scores, the union station and its nearby area have the highest rating.

```{r, results='markup'}
ggplot(df_175,aes(x=neighbourhood_short, y=review_scores_rating))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = c(3,5))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=neighbourhood_short))+
  theme(axis.text.x = element_text(angle = 90, size=9))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        labs( x="Neighborhood", y="Rating")+
        ggtitle("Box Plot of Rating Distribution by Neighborhood")

```

```{r, results = 'markup'}
rating_neighbor = df_175 %>%
  group_by(neighbourhood) %>%
  summarise_at(vars(review_scores_rating), list(review_scores_rating = mean))
rating_neighbor = data.frame(rating_neighbor)
#rating_neighbor
rating_neighbor[order(-rank(rating_neighbor$review_scores_rating), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

To confirm the trends we have identified in our boxplot, we again ran an ANOVA where we tested against our hypothesis that there was no significant difference between the mean price across DC neighborhoods. Our results show a p-value, less than 0.05, almost close to 0, which proves that there is a significant difference between prices by neighborhood.
```{r results = 'markup'}
#anova test to compare mean rating
anovaRes_rating1 <-  aov(review_scores_rating ~  neighbourhood, data=df_175)
xkabledply(anovaRes_rating1, title = "Rating by Neighborhood ANOVA")
```

# Results
## What neighbourhood has the best value?

Our first question for this dataset asks what neighborhoods in DC offer the best value to Airbnb renters. For this question, we will define “value” as a rental unit where the price is below the average and the review rating score is above the average. Relating to the previous ANOVA results about how average price and average rating are related to neighborhoods, we will use this knowledge to assume there must be a DC neighborhood with the better prices/ratings than others. We graphed mean neighborhood price versus mean neighborhood review rating score in the scatterplot below. We used the overall mean price and mean review rating score for our subset to provide our cutoff for value, this is shown below in red. 

```{r, results = 'markup'}
ggplot(means_df) + geom_point(aes(x=review_scores_rating, y=price, colour=neighbourhood_short),size=4)+ theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position="right")+
        labs(colour = "Neighborhood", x="Mean Rating", y="Mean Price")+
        ggtitle("Mean Price by Mean Rating for DC Neighborhoods")+ geom_hline(yintercept=mean(means_df$price), linetype="dashed", color = "red")+
        annotate("text", x=4.635, y=(mean(means_df$price)+3), label="Overall Price Avg", color = "red",size=3)+
   geom_vline(xintercept=mean(means_df$review_scores_rating), linetype="dashed", color = "red")+
        annotate("text", x=(mean(means_df$review_scores_rating)+.023), y=122.7, label="Overall Rating Avg", color = "red",size=3)
means_df_select <- means_df[which(means_df$price<mean(means_df$price) & means_df$review_scores_rating > mean(means_df$review_scores_rating)),]
#id for neighborhoods
means_df_select$ID <- seq.int(nrow(means_df_select))
means_df_select[c(8,2:4)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)

#short for presentation

means_df_select[c(8,2:3)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

This revealed three neighborhoods that have an overall average Airbnb price lower than the group mean and a review rating score mean higher than the group mean. These neighborhoods are mapped below based on the mean longitude and latitude of the listings in the neighborhood. The size of the bubble represents the comparative frequency of listings in the neighborhood. 

```{r, results='markup'}
pal1 <- colorFactor(c("#72B000","#00BFC4","#7997ff"), domain = c("Columbia Height", "Edgewood, Bloom", "Kalorama Height"))
# create leaflet map 
map <- leaflet(means_df_select) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~longitude,
                   lat = ~latitude, 
                   radius=~sqrt(Freq),
                   color=~pal1(neighbourhood_short),
                   label=~ID,
                   labelOptions = labelOptions(noHide = T, textOnly = T, textsize = "7px",direction = 'center',style = list(
        "color" = "white")),
                   stroke = FALSE, 
                   fillOpacity = 0.7)%>%
  addLegend("bottomright",pal = pal1, values = ~means_df_select$neighbourhood_short, opacity = 1, title = "Room Type")
map %>%  addProviderTiles(providers$CartoDB.Positron)
```


## What neighbourhood has the best value by room types?

To see if our neighborhoods with the best value change by room type, we added room type into our best value analysis. For this analysis, we calculated our neighborhood means by room type and then plotted each against the average price and review rating score by room type. This is plotted in the scatter plot below where the neighborhood is indicated by color and room type is shown by shape. Each group mean for comparison is marked by a horizontal or vertical line. 

```{r, results='markup'}
means_df_rt_eha <- means_df_rt[which(means_df_rt$room_type=="Entire home/apt"),]
means_df_rt_pr <- means_df_rt[which(means_df_rt$room_type=="Private room"),]
means_df_rt_sr <- means_df_rt[which(means_df_rt$room_type=="Shared room"),]
means_df_rt_hr <- means_df_rt[which(means_df_rt$room_type=="Hotel room"),]
ggplot(means_df_rt) + geom_point(aes(x=review_scores_rating, y=price, colour=neighbourhood_short, shape=room_type),size=4, alpha=.85)+  scale_shape_manual(values=c(21,22,23,24))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position="right")+
        labs(colour = "Neighborhood", x="Mean Rating", y="Mean Price")+
        ggtitle("Mean Price by Mean Rating in DC Neighborhoods")+ geom_hline(yintercept=mean(means_df_rt_eha$price), linetype="dashed", color = "#51c5ed")+
        annotate("text", x=2.7, y=(mean(means_df_rt_eha$price)+8), label="Entire home/apt avg", color = "#51c5ed",size=3)+
        geom_vline(xintercept=mean(means_df_rt_eha$review_scores_rating), linetype="dashed", color = "#51c5ed")+       
        geom_hline(yintercept=mean(means_df_rt_pr$price), linetype="dashed", color = "#C3EB78")+ 
        annotate("text", x=2.6, y=(mean(means_df_rt_pr$price)+8), label="Private room avg", color = "#C3EB78",size=3)+
        geom_vline(xintercept=mean(means_df_rt_pr$review_scores_rating), linetype="dashed", color = "#C3EB78")+
        geom_hline(yintercept=mean(means_df_rt_sr$price), linetype="dashed", color = "#ff616f")+
        annotate("text", x=2.6, y=(mean(means_df_rt_sr$price)+8), label="Shared room avg", color = "#ff616f",size=3)+
        geom_vline(xintercept=mean(means_df_rt_sr$review_scores_rating), linetype="dashed", color = "#ff616f")+
        geom_hline(yintercept=mean(means_df_rt_hr$price), linetype="dashed", color = "#3D348B")+
        annotate("text", x=2.6, y=(mean(means_df_rt_hr$price)+8), label="Hotel room avg", color = "#3D348B",size=3)+
        geom_vline(xintercept=mean(means_df_rt_hr$review_scores_rating), linetype="dashed", color = "#3D348B")
means_df_rt_eha_select <- means_df_rt_eha[which(means_df_rt_eha$price<mean(means_df_rt_eha$price) & means_df_rt_eha$review_scores_rating > mean(means_df_rt_eha$review_scores_rating)),]
means_df_rt_pr_select <- means_df_rt_pr[which(means_df_rt_pr$price<mean(means_df_rt_pr$price) & means_df_rt_pr$review_scores_rating > mean(means_df_rt_pr$review_scores_rating)),]
means_df_rt_sr_select <- means_df_rt_sr[which(means_df_rt_sr$price<mean(means_df_rt_sr$price) & means_df_rt_sr$review_scores_rating > mean(means_df_rt_sr$review_scores_rating)),]
means_df_rt_hr_select <- means_df_rt_hr[which(means_df_rt_hr$price<mean(means_df_rt_hr$price) & means_df_rt_hr$review_scores_rating > mean(means_df_rt_hr$review_scores_rating)),]
means_df_rt_select <- rbind(means_df_rt_eha_select,means_df_rt_pr_select,means_df_rt_sr_select,means_df_rt_hr_select)
```

```{r, results = 'markup'}
#id for neighborhoods
means_df_rt_select$ID <- seq.int(nrow(means_df_rt_select))
means_df_rt_select[c(9,2:5)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)

#short for presentation

means_df_rt_select[c(9,2:3)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

This revealed a list of neighborhoods different from the list we found in the overall comparison. The results are mapped below based on the mean longitude and latitude of the listings in the neighborhood. The color indicates the room type and the size shows the comparative frequency of listings in the neighborhood. What we find is that the large proportion of data being entire places, skewed our overall neighborhood results as our entire place results mimic those results the most, while our additional room types vary. The only room type with no deals selected is the hotel type. This is most likely due to the lack of data to produce neighborhoods that differ from both the mean price and rating. 

```{r, results='markup'}
#color palette
pal2 <- colorFactor(c("#51c5ed","#C3EB78","#ff616f","#3D348B"), domain = c("Entire home/apt","Shared room","Private room","Hotel room"))
# create leaflet map 
map2 <- leaflet(means_df_rt_select) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~longitude,
                   lat = ~latitude, 
                   radius=~sqrt(Freq),
                   color=~pal2(room_type),
                   label=~ID,
                   labelOptions = labelOptions(noHide = T, textOnly = T, textsize = "7px",direction = 'center',style = list(
        "color" = "white")),
                   stroke = FALSE, 
                   fillOpacity = 0.6)%>% 
addLegend("bottomright",pal = pal2, values = ~means_df_rt_select$room_type, opacity = 1, title = "Room Type")
map2 %>%  addProviderTiles(providers$CartoDB.Positron)
```


## Do names of listings have an influence on value?

The listing name is added by the host themselves in order to make the listing as attractive as possible. All listings try to keep catchy and attractive names to get clicks by prospective guests. It usually contains features of the place, such as “near metro” and “spacious”. We want to investigate whether names with certain characteristics are better or worse than others. We believe that these listing names contain information that might not otherwise be present in any of the columns in the dataset.

```{r, results = 'markup'}
data(stop_words)
corpus <- df %>% select(id, name) %>%
  unnest_tokens(word, name) %>% filter(!word %in% stop_words$word, str_detect(word, "[a-z]"))
all_words <- corpus %>% group_by(word) %>% dplyr::summarise(count = n())
wordcloud(words = all_words$word, freq = all_words$count, , min.freq = 50, colors=brewer.pal(8, "Dark2"))
```

We created a word cloud to identify if there were any terms that were more prevalent than others. The size of the word indicates frequency, and sure enough, some terms are indeed more frequent than others. The wordcloud shows that certain key words such as metro, basement, private, townhouse, metro etc are present in a lot of listings.

Now we want to investigate whether some terms indicate higher value. Here value is defined as a combination of rating and price. We plot each term on a scatter plot with rating on the X-axis and price on the Y-axis, with size indicating the frequency.

```{r, results = 'markup'}
df_corpus <- corpus %>% left_join(df)
corpus_agg <- df_corpus %>% 
  group_by(word) %>% 
  dplyr::summarise(avg_rating = mean(review_scores_rating), avg_price = mean(price), count = n()) %>% 
  filter(count > 150)
ggplot(corpus_agg, aes(x=avg_rating, y=avg_price)) + geom_text(label=corpus_agg$word, aes(size=count, color = word)) + scale_size_continuous(range = c(2, 10)) + guides(color=FALSE)
```

Some key takeaways from this are that historical places are the highest-rated and are ideal for someone looking for a satisfying stay. Furthermore, places near a metro are rated similarly to places with parking, despite being much cheaper. This would make someone think twice about bringing a car to the city.

# Conclusion and Discussion

Beginning with the dataset, it has a few limitations. There are too many data columns but the number of useful columns is way less than the total number. It has many columns about the rating scores, but it does not have the data column of users’ comments. Most rating scores are clustered between 4.0 and 5.0, so it could be hard to do future differentiations on ratings, but it may be much easier with the complement of users’ text reviews if we can determine the positivity and the negativity of users’ attitudes showing from their comments. 

During the Exploratory Data Analysis, we have obtained a few interesting findings by investigating the best neighborhoods by multiple factors, which help us answer our current research questions. We think there is no need to change our questions because price and review rating scores do play important roles in deciding an Airbnb’s value differently, with the additional consideration of room types. 

For the current status, we have conducted an initial study related to price, rating, neighborhoods, and room types. We could introduce other data columns like amenities. Each listing may provide different amenities, and we have turned the amenities column’s values of amenity list into an integer count of each list. Studying how amenities affect the rating and the price could be a potential question. Each listing could have a different set of amenities differentiated in quantity and quality. So it would be an interesting approach if we add the amenities into our next step of research. The number of reviews and the total number of ratings would be helpful to distinguish the hosts, learning who are excellent hosts.

# References

1. Bustamante, J. (2021, November 4). Airbnb statistics [2021]: User & market growth data. iPropertyManagement.com. Retrieved November 7, 2021, from https://ipropertymanagement.com/research/airbnb-statistics.

2. Cheng, M., & Jin, X. (2018, May 1). What do airbnb users care about? an analysis of online review comments. International Journal of Hospitality Management. Retrieved November 7, 2021, from https://www.sciencedirect.com/science/article/pii/S0278431917307491?casa_token=RtKGCn1sDZEAAAAA%3ApDdFk5V-qR-b2TLSDQimzIdh8LleualUtg7nQzMMapsoco44oZbA4qZ1J7zAWpbYkjNr1FI-5dg.