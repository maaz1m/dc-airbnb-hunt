---
title: "D.C. Airbnb Hunt"
author: "Foo Fivers"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
    toc: true
    number_sections: true

---

```{r, echo = FALSE, results = 'hide', message = FALSE}
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(readr)
library(plyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(leaflet)
library(tidytext)
library(stringr)
library(wordcloud)
library(ezids)
knitr::opts_chunk$set(warning = FALSE, echo=FALSE, results='hide')
```

# Motivation

As travel continues to open up across the world, more travelers are exploring locations they are unfamiliar with. Lodging is a crucial, yet complicated decision to make when traveling to a new location. There are many factors to take into consideration, and they all come at a cost. The gig economy has opened up more opportunities for travelers as private homeowners are able to provide a more customized experience at a competitive price compared to major hotel chains. 

Airbnb is a hotel competitor, which provides lodging for visitors in predominantly privately owned residences. According to the statistical data posted by ipropertymanagement, the general price of Airbnb listings in Europe is about 8%-17% cheaper than the hotels, while the percentage is 6% - 17% cheaper in the United States (paragraph 4). Unlike large hotel chains, where the experience is designed to be similar across numerous locations, Airbnbs offer a diverse experience, for better or for worse. Due to this variety, ratings have become an important factor when placing a booking. These aggregated user rating signal to future users the quality of stay over a variety of factors, such as experience, cleanliness, accuracy, value, etc. 

Travelers looking through an Airbnb website or app may have hundreds of options to choose from depending on their preferences and locality. Narrowing it down to just one Airbnb rental could be a painstaking process of research and comparison. Exploring the dataset of all listings in a locality such as DC, can provide a better understanding of the crucial decision-making KPI of listing rating, as well as give insight to travelers about how to best subset or limit their vacation rental search.

# Existing work

# Dataset

This data will come from `Inside Airbnb` , an open-source data tool providing web scraped Airbnb listing information by city.

```{r}
df <- read.csv('listings_detailed.csv')
colnames(df)
df <- df %>% 
  dplyr::select(id, name, host_is_superhost, host_listings_count, neighbourhood_cleansed, latitude, longitude, room_type, bedrooms, beds, amenities, price, availability_60, number_of_reviews, review_scores_rating,  review_scores_accuracy, review_scores_cleanliness,
            review_scores_checkin, review_scores_communication, review_scores_location, review_scores_value, reviews_per_month) %>% 
  dplyr::mutate(price = as.numeric(parse_number(price)),
         neighbourhood_cleansed = as.factor(neighbourhood_cleansed),
         amenities = lengths(strsplit((str_sub(df$amenities, 2, -2)), ",")),
         room_type = as.factor(room_type),
         bedrooms = as.factor(bedrooms)) %>%
  dplyr::rename(neighbourhood = neighbourhood_cleansed)
df = na.omit(df)
```
To begin the AirBnB search for our friend, we must prepare our data for analysis. With this dataset we will select the `r ncol(df)` variables that will help us answer this question. We will also make sure all of our variables are in the appropriate form, rename necessary columns and remove na values. With this cleansing our dataset now has `r nrow(df)` airbnb units for analysis. 

## Data Summary
```{r}
glimpse(df)

#pretty output for presentation
str(df)

data.frame(variable = names(df),
           classe = sapply(df, typeof),
           first_values = sapply(df, function(x) paste0(head(x,2),  collapse = ", ")),
           row.names = NULL) %>% 
  kable()

```

## Limitations of Dataset

# Descriptive statistics

## Histogram and QQ plot for Price
```{r, fig.show='hide'}
Price_No_Outlier = outlierKD2(df, price, rm=TRUE)
```

```{r}
par(mfrow = c(1,2))
hist(Price_No_Outlier$price, main = 'Histogram of Price', xlim = c(0,350))
qqnorm(Price_No_Outlier$price, main="Q-Q plot of Price")
qqline(Price_No_Outlier$price)
```

## Histogram and QQ plot for Number of Reviews

```{r, fig.show='hide'}
Number_of_Reviews_No_Outlier = outlierKD2(df, number_of_reviews, rm=TRUE)
```

```{r}
par(mfrow = c(1,2))
hist(Number_of_Reviews_No_Outlier$number_of_reviews, main = 'Histogram of Number of Reviews', xlim = c(0,200))
qqnorm(Number_of_Reviews_No_Outlier$number_of_reviews, main="Q-Q plot of Number of Reviews")
qqline(Number_of_Reviews_No_Outlier$number_of_reviews)
```

## Histogram and QQ plot for Amenities

```{r, fig.show='hide'}
Number_of_Amenities_No_Outlier = outlierKD2(df, amenities, rm=TRUE)
```

```{r}
par(mfrow = c(1,2))
hist(Number_of_Amenities_No_Outlier$amenities, main = 'Histogram of Amenities', xlim = c(0,65))
qqnorm(Number_of_Amenities_No_Outlier$amenities, main="Q-Q plot of Amenities")
qqline(Number_of_Amenities_No_Outlier$amenities)
```

## Histogram and QQ plot for Review Scores

```{r, fig.show='hide'}
Number_of_review_scores_rating_No_Outlier = outlierKD2(df, review_scores_rating, rm=TRUE)
```

```{r}
par(mfrow = c(1,2))
hist(Number_of_review_scores_rating_No_Outlier$review_scores_rating, main = 'Histogram of Review Scores', xlim = c(4,6))
qqnorm(Number_of_review_scores_rating_No_Outlier$review_scores_rating, main="Q-Q plot of Review scores")
qqline(Number_of_review_scores_rating_No_Outlier$review_scores_rating)
```

## Histogram and QQ plot for Reviews per Month

```{r, fig.show='hide'}
Number_of_reviews_per_month_No_Outlier = outlierKD2(df, reviews_per_month, rm=TRUE)
```

```{r}
par(mfrow = c(1,2))
hist(Number_of_reviews_per_month_No_Outlier$reviews_per_month, main = 'Histogram of Reviews per Month', xlim = c(0,10))
qqnorm(Number_of_reviews_per_month_No_Outlier$reviews_per_month, main="Q-Q plot of Reviews per Month")
qqline(Number_of_reviews_per_month_No_Outlier$reviews_per_month)
```


# SMART Questions

To provide greater insights for travelers looking to book an Airbnb in DC, we will be utilizing the DC Airbnb listing data to identify the neighborhoods within DC that provide the best overall value properties (highest rating at the lowest price). This will be our primary SMART question. Furthermore, we will also analyze additional factors to look for in a listing to ensure a high-quality visit to the district. For example, we would like to discover the influence of room type in the decision of neighborhoods. In addition, we are interested in how listing names posted by the hosts affect their Airbnbs’ values.

# Exploratory Data Analysis

## Room types

To better understand the AirBnB market in DC, we will first look at the split out of room types and their proportions in the district. This pie chart shows us that there are four types of rooms offered from AirBnB in DC and that Entire home/apt makes up the greatest proportion of these units. 

```{r}
d = as.data.frame(table(df$room_type))
group.colors = c("Entire home/apt" ="#51c5ed","Shared room"="#C3EB78","Private room"="#ff616f","Hotel room"="#3D348B")
ggplot(d, aes(y = Freq, x = "", fill = Var1)) + geom_bar(width=3, stat = "identity")+ coord_polar("y", start = 0)  + labs(title = "DC AirBnB Pie Chart of Room Types", x = "", y = "")+ 
  theme(
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),legend.position="right")+
        scale_fill_manual(values=group.colors)+
        labs(fill = "Room Type")
```

## Neighorhood and Room Type

We will now split this out by neighborhood to see where there is the greatest selection of AirBnB units in the district. 

```{r}
#create column for neighborhood name in visualizations
df$neighbourhood_short <- str_sub(df$neighbourhood,1,15)
#add in column for frequency of listings
df_freq <- merge(df, data.frame(table(neighbourhood = df$neighbourhood)), by = c("neighbourhood"))
#create barplot of airbnb frequency by DC neighborhoods
ggplot(df_freq,aes(x=reorder(neighbourhood_short, neighbourhood_short, function(x)-length(x))))+geom_bar(aes(fill = room_type), alpha=.9)+ theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),legend.position="top")+
        scale_fill_manual(values=group.colors)+
        labs(fill = "Room Type", x="Neighborhood", y="# of AirBnBs Listed")+
        ggtitle("Frequency of AirBnBs by Neighborhood and Room Type") 
#v = as.data.frame(table(df$neighbourhood))
#v1 = v %>% slice(1:20)
#v2 = v %>% slice(21:50)
#par(mfrow = c(1,2))
#barplot(v1$Freq, main = "Barplot of Neighborhood Counts P1", ylab = "Count",  width = 5, names.arg = v1$Var1, las = 2, cex.names=0.6, col = 'darkred')
#barplot(v2$Freq, main = "Barplot of Neighborhood Counts P2", ylab = "Count",  width = 5, names.arg = v2$Var1, las = 2, cex.names=0.6, col = 'lightblue')
```


## Price and room type
We are not sure what room type our friend is looking for. So, to allow them to understand the options, we will plot average price by room type. As we saw in the summary statistics, there is a large spread on this data. So, we will be viewing these plots zoomed in to the 0 - 95th percentile. A descending rank list of mean price across room types is given.

```{r}
ggplot(df,aes(x=room_type, y=price))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = quantile(df$price, c(0.0, .95)))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=room_type))+
  theme(axis.text.x = element_text(angle = 90, size=10))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        scale_colour_manual(values=group.colors)+
        labs( x="Room Type", y="Price")+
        ggtitle("Box Plot of Price Distribution by Room Type")
```
```{r}
price_room = df %>%
  group_by(room_type) %>%
  summarise_at(vars(price), list(price = mean))
price_room = data.frame(price_room)
price_room[order(-rank(price_room$price), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

## Reviews and room type

Now we will do the same for rating. This time we will zoom from the 1st to 100th percentile. A descending rank list of mean rating score across room types is given.

```{r}
ggplot(df,aes(x=room_type, y=review_scores_rating))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = quantile(df$review_scores_rating, c(.01, 1)))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=room_type))+
  theme(axis.text.x = element_text(angle = 90, size=10))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        scale_colour_manual(values=group.colors)+
        labs( x="Room Type", y="Rating")+
        ggtitle("Box Plot of Rating Distribution by Room Type")
```

```{r}
rating_room = df %>%
  group_by(room_type) %>%
  summarise_at(vars(review_scores_rating), list(review_scores_rating = mean))
rating_room = data.frame(rating_room)
rating_room[order(-rank(rating_room$review_scores_rating), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```


## Price and neighbourhood

Now we will start to look into the neighborhoods in DC. First, we will compare price across the neighborhoods. Before we do this, we should narrow down the neighborhood options for our friend. With our initial dataset, we find there are `r n_distinct(df$neighbourhood)` DC neighborhoods we could recommend our friend look for an AirBnB. We want to make sure that our friend has a large number of AirBnBs to select from our final neighborhood selection. So, we will now only include only neighborhoods with over 200 AirBnB units listed with review and pricing data. 

```{r}
#subset data where frequency is greater than 175
df_175 <-  df_freq[ which(df_freq$Freq>175), ]

str(df_175)
```

Our subsetted data set now has `r n_distinct(df_175$neighbourhood)` neighborhoods with `r nrow(df_175)` data points to analyze. 

We can now analyze price across neighborhoods. To better view this graph, we will be zooming in to view the 0th to 95th percentile. A descending rank list of mean price across the neighborhoods is given.

```{r}
ggplot(df_175,aes(x=neighbourhood_short, y=price))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = quantile(df$price, c(.0, .95)))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=neighbourhood_short))+
  theme(axis.text.x = element_text(angle = 90, size=9))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        labs( x="Neighborhood", y="Price")+
        ggtitle("Box Plot of Price Distribution by Neighborhood")
```

```{r}
price_neighbor = df_175 %>%
  group_by(neighbourhood) %>%
  summarise_at(vars(price), list(price = mean))
price_neighbor = data.frame(price_neighbor)
price_neighbor[order(-rank(price_neighbor$price), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

## Reviews and neighbourhood

Next we will look at rating across neighborhoods. To better view this graph, we will be zooming in to view the 3rd to 100th percentile. A descending rank list of mean price across the neighborhoods is given.

```{r}
ggplot(df_175,aes(x=neighbourhood_short, y=review_scores_rating))+ geom_boxplot(outlier.shape = NA ) +
coord_cartesian(ylim = c(3,5))+
  geom_jitter(width=0.15, alpha=.2, aes(colour=neighbourhood_short))+
  theme(axis.text.x = element_text(angle = 90, size=9))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position = "none")+
        labs( x="Neighborhood", y="Rating")+
        ggtitle("Box Plot of Rating Distribution by Neighborhood")

```

```{r}
rating_neighbor = df_175 %>%
  group_by(neighbourhood) %>%
  summarise_at(vars(review_scores_rating), list(review_scores_rating = mean))
rating_neighbor = data.frame(rating_neighbor)
#rating_neighbor
rating_neighbor[order(-rank(rating_neighbor$review_scores_rating), decreasing = FALSE), ]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```


# Results

## What neighbourhood has the best value?

To find the neighborhood that has the best AirBnB for rating and price, we will compare the mean price vs. mean rating for our 10 neighborhoods. 

First, we will run an ANOVA to see if there is any significant difference between the price and rating averages across neighborhoods, then we will graph and select our best neighborhood selection. 

```{r}
#anova test to compare mean price
anovaRes_price1 <-  aov(price ~ neighbourhood, data=df_175)
xkabledply(anovaRes_price1, title = "Price by Neighborhood ANOVA")
#anova test to compare mean rating
anovaRes_rating1 <-  aov(review_scores_rating ~  neighbourhood, data=df_175)
xkabledply(anovaRes_rating1, title = "Rating by Neighborhood ANOVA")

#EXTRA
#anova test to compare mean amenities
#anovaRes_amenities1 <-  aov(amenities ~  neighbourhood, data=df_175)
#xkabledply(anovaRes_amenities1, title = "Amenities by Neighborhood ANOVA")
```
What we find in both of these Anova results is that there is a significant difference between average price and rating by neighborhood. We will use this knowledge to assume there must be a DC neighborhood with the better prices/ratings than others. 

```{r}
#create mean columns in dataframe
means_df <- df_175 %>%
  group_by(neighbourhood_short,neighbourhood) %>%
  summarise_at(vars(c(price,review_scores_rating, Freq, latitude,longitude)), funs(mean(., na.rm=TRUE)))
means_df_rt <- df_175 %>%
  group_by(neighbourhood_short,neighbourhood,room_type) %>%
  summarise_at(vars(c(price,review_scores_rating, Freq, latitude,longitude)), funs(mean(., na.rm=TRUE)))
ggplot(means_df) + geom_point(aes(x=review_scores_rating, y=price, colour=neighbourhood_short),size=4)+ theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position="right")+
        labs(colour = "Neighborhood", x="Mean Rating", y="Mean Price")+
        ggtitle("Mean Price by Mean Rating for DC Neighborhoods")+ geom_hline(yintercept=mean(means_df$price), linetype="dashed", color = "red")+
        annotate("text", x=4.635, y=(mean(means_df$price)+3), label="Overall Price Avg", color = "red",size=3)+
   geom_vline(xintercept=mean(means_df$review_scores_rating), linetype="dashed", color = "red")+
        annotate("text", x=(mean(means_df$review_scores_rating)+.023), y=122.7, label="Overall Rating Avg", color = "red",size=3)
means_df_select <- means_df[which(means_df$price<mean(means_df$price) & means_df$review_scores_rating > mean(means_df$review_scores_rating)),]
#id for neighborhoods
means_df_select$ID <- seq.int(nrow(means_df_select))
means_df_select[c(8,2:4)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)

#short for presentation

means_df_select[c(8,2:3)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

We find that we have `r nrow(means_df_select)` neighborhoods to suggest to our friend where the overall AirBnB price is less than DC's averaEntire home/aptge and where the rating is greater than DC's average. We can map these out below. 

```{r}
pal1 <- colorFactor(c("#72B000","#00BFC4","#7997ff"), domain = c("Columbia Height", "Edgewood, Bloom", "Kalorama Height"))
# create leaflet map 
map <- leaflet(means_df_select) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~longitude,
                   lat = ~latitude, 
                   radius=~sqrt(Freq),
                   color=~pal1(neighbourhood_short),
                   label=~ID,
                   labelOptions = labelOptions(noHide = T, textOnly = T, textsize = "7px",direction = 'center',style = list(
        "color" = "white")),
                   stroke = FALSE, 
                   fillOpacity = 0.7)%>%
  addLegend("bottomright",pal = pal1, values = ~means_df_select$neighbourhood_short, opacity = 1, title = "Room Type")
map %>%  addProviderTiles(providers$CartoDB.Positron)
```

This is helpful, but we should probably include room type to help our friend know if there is a room type/neighboorhood combination that would be the rest to search for. 

Let's run an anova to see if there is a significant difference between mean price and mean rating by room type.

```{r}
#anova test to compare mean price
anovaRes_price2 <-  aov(price ~ room_type, data=means_df_rt)
xkabledply(anovaRes_price2, title = "Price by Room Type ANOVA")

#anova test to compare mean rating
anovaRes_rating2 <-  aov(review_scores_rating ~ room_type, data=means_df_rt)
xkabledply(anovaRes_rating2, title = "Rating by Room Type ANOVA")

#EXTRA
#anova test to compare mean amenities
#anovaRes_amenities2 <-  aov(amenities ~ room_type, data=means_df_rt)
#xkabledply(anovaRes_amenities2, title = "Amenities by Room Type ANOVA")
```
What we find is that for price and rating, room type is something to consider as there are significant differences between the mean prices. 

We will show our friend an analysis where we look for the best true values by room type where the AirBnBs have a price lower than the mean and rating higher than the mean.







## What neighbourhood has the best value by room type?
From our analysis above, we know there is a significant difference in price and review rating score across room types. To see if our neighborhoods with the best value change by room type, we added room type into our best value analysis. For this analysis, we calculated our neighborhood means by room type and then plotted each against the average price and review rating score by room type. This is plotted in the scatter plot below where the neighborhood is indicated by color and room type is shown by shape. Each group mean for comparison is marked by a horizontal or vertical line. 

Now we can map by room type suggestions

```{r}
means_df_rt_eha <- means_df_rt[which(means_df_rt$room_type=="Entire home/apt"),]
means_df_rt_pr <- means_df_rt[which(means_df_rt$room_type=="Private room"),]
means_df_rt_sr <- means_df_rt[which(means_df_rt$room_type=="Shared room"),]
means_df_rt_hr <- means_df_rt[which(means_df_rt$room_type=="Hotel room"),]
ggplot(means_df_rt) + geom_point(aes(x=review_scores_rating, y=price, colour=neighbourhood_short, shape=room_type),size=4, alpha=.85)+  scale_shape_manual(values=c(21,22,23,24))+
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        legend.title=element_text(size=9),
        plot.title = element_text(color="black", face="bold", size=16, hjust=0),
        panel.grid.major = element_line(colour = "grey90", size = 0.2),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = 'white'),
        legend.position="right")+
        labs(colour = "Neighborhood", x="Mean Rating", y="Mean Price")+
        ggtitle("Mean Price by Mean Rating in DC Neighborhoods")+ geom_hline(yintercept=mean(means_df_rt_eha$price), linetype="dashed", color = "#51c5ed")+
        annotate("text", x=2.7, y=(mean(means_df_rt_eha$price)+8), label="Entire home/apt avg", color = "#51c5ed",size=3)+
        geom_vline(xintercept=mean(means_df_rt_eha$review_scores_rating), linetype="dashed", color = "#51c5ed")+       
        geom_hline(yintercept=mean(means_df_rt_pr$price), linetype="dashed", color = "#C3EB78")+ 
        annotate("text", x=2.6, y=(mean(means_df_rt_pr$price)+8), label="Private room avg", color = "#C3EB78",size=3)+
        geom_vline(xintercept=mean(means_df_rt_pr$review_scores_rating), linetype="dashed", color = "#C3EB78")+
        geom_hline(yintercept=mean(means_df_rt_sr$price), linetype="dashed", color = "#ff616f")+
        annotate("text", x=2.6, y=(mean(means_df_rt_sr$price)+8), label="Shared room avg", color = "#ff616f",size=3)+
        geom_vline(xintercept=mean(means_df_rt_sr$review_scores_rating), linetype="dashed", color = "#ff616f")+
        geom_hline(yintercept=mean(means_df_rt_hr$price), linetype="dashed", color = "#3D348B")+
        annotate("text", x=2.6, y=(mean(means_df_rt_hr$price)+8), label="Hotel room avg", color = "#3D348B",size=3)+
        geom_vline(xintercept=mean(means_df_rt_hr$review_scores_rating), linetype="dashed", color = "#3D348B")
means_df_rt_eha_select <- means_df_rt_eha[which(means_df_rt_eha$price<mean(means_df_rt_eha$price) & means_df_rt_eha$review_scores_rating > mean(means_df_rt_eha$review_scores_rating)),]
means_df_rt_pr_select <- means_df_rt_pr[which(means_df_rt_pr$price<mean(means_df_rt_pr$price) & means_df_rt_pr$review_scores_rating > mean(means_df_rt_pr$review_scores_rating)),]
means_df_rt_sr_select <- means_df_rt_sr[which(means_df_rt_sr$price<mean(means_df_rt_sr$price) & means_df_rt_sr$review_scores_rating > mean(means_df_rt_sr$review_scores_rating)),]
means_df_rt_hr_select <- means_df_rt_hr[which(means_df_rt_hr$price<mean(means_df_rt_hr$price) & means_df_rt_hr$review_scores_rating > mean(means_df_rt_hr$review_scores_rating)),]
means_df_rt_select <- rbind(means_df_rt_eha_select,means_df_rt_pr_select,means_df_rt_sr_select,means_df_rt_hr_select)
```

```{r}
#id for neighborhoods
means_df_rt_select$ID <- seq.int(nrow(means_df_rt_select))
means_df_rt_select[c(9,2:5)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)

#short for presentation

means_df_rt_select[c(9,2:3)]%>% 
  kbl() %>%
  kable_paper("hover", full_width = F)
```

```{r}
#color palette
pal2 <- colorFactor(c("#51c5ed","#C3EB78","#ff616f","#3D348B"), domain = c("Entire home/apt","Shared room","Private room","Hotel room"))
# create leaflet map 
map2 <- leaflet(means_df_rt_select) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~longitude,
                   lat = ~latitude, 
                   radius=~sqrt(Freq),
                   color=~pal2(room_type),
                   label=~ID,
                   labelOptions = labelOptions(noHide = T, textOnly = T, textsize = "7px",direction = 'center',style = list(
        "color" = "white")),
                   stroke = FALSE, 
                   fillOpacity = 0.6)%>% 
addLegend("bottomright",pal = pal2, values = ~means_df_rt_select$room_type, opacity = 1, title = "Room Type")
map2 %>%  addProviderTiles(providers$CartoDB.Positron)
```


This revealed a list of neighborhoods different from the list we found in the overall comparison. The results are mapped below based on the mean longitude and latitude of the listings in the neighborhood. The color indicates the room type and the size shows the comparative frequency of listings in the neighborhood. What we find is that the large proportion of data being entire places, skewed our overall neighborhood results as our entire place results mimic those results the most, while our additional room types vary. The only room type with no deals selected is the hotel type. This is most likely due to the lack of data to produce neighborhoods that differ from both the mean price and rating. 


## Do names of listings have an influence on value?

The listing name is added by the host themselves in order to make the listing as attractive as possible. It usually contains features of the place, such as “near metro” and “spacious”. We believe that these listing names contain information that might not otherwise be present in any of the columns in the dataset.

```{r}
data(stop_words)
corpus <- df %>% select(id, name) %>%
  unnest_tokens(word, name) %>% filter(!word %in% stop_words$word, str_detect(word, "[a-z]"))
all_words <- corpus %>% group_by(word) %>% dplyr::summarise(count = n())
wordcloud(words = all_words$word, freq = all_words$count, , min.freq = 50, colors=brewer.pal(8, "Dark2"))
```


We created a word cloud to identify if there were any terms that were more prevalent than others. The size of the word indicates frequency, and sure enough, some terms are indeed more frequent than others. Now we want to investigate whether some terms indicate higher value. Here value is defined as a combination of rating and price. We plot each term on a scatter plot with rating on the X-axis and price on the Y-axis, with size indicating the frequency.


```{r}
df_corpus <- corpus %>% left_join(df)
corpus_agg <- df_corpus %>% 
  group_by(word) %>% 
  dplyr::summarise(avg_rating = mean(review_scores_rating), avg_price = mean(price), count = n()) %>% 
  filter(count > 150)
ggplot(corpus_agg, aes(x=avg_rating, y=avg_price)) + geom_text(label=corpus_agg$word, aes(size=count, color = word)) + scale_size_continuous(range = c(2, 10)) + guides(color=FALSE)
```

Some key takeaways from this are that historical places are the highest-rated and are ideal for someone looking for a satisfying stay. Furthermore, places near a metro are rated similarly to places with parking, despite being much cheaper. This would make someone think twice about bringing a car to the city. 

# Conclusion and Discussion

For the current research, we have conducted an initial study related to price, rating, neighborhoods, and room types. We could introduce other data columns like amenities. Each listing could have a different set of amenities differentiated in quantity and quality. So it would be an interesting approach if we add the amenities into our next step of research. The number of reviews and the total number of ratings would be helpful to distinguish the hosts, learning who are excellent hosts.

# References
Bustamante, J. (2021, November 4). Airbnb statistics [2021]: User & market growth data. iPropertyManagement.com. Retrieved November 7, 2021, from https://ipropertymanagement.com/research/airbnb-statistics. 
Cheng, M., & Jin, X. (2018, May 1). What do airbnb users care about? an analysis of online review comments. International Journal of Hospitality Management. Retrieved November 7, 2021, from https://www.sciencedirect.com/science/article/pii/S0278431917307491?casa_token=RtKGCn1sDZEAAAAA%3ApDdFk5V-qR-b2TLSDQimzIdh8LleualUtg7nQzMMapsoco44oZbA4qZ1J7zAWpbYkjNr1FI-5dg. 
