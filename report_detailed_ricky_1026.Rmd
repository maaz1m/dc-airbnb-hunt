---
title: "D.C. Airbnb Hunt"
author: "Foo Fivers"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

## D.C. Airbnb Hunt

For this project, Team Five has been propositioned by a visiting friend to recommend a neighborhood in DC that offers the best Airbnb deals. To provide an informed suggestion, the team will be using listing data from Airbnbs in DC to answer the question “What DC neighborhood offers Airbnb listings with the highest ratings at the lowest price?”. The team will provide an overall neighborhood suggestion for where to book the best Airbnb deal in DC as well as by type (entire home, private room, etc) and budget. . This data will come from `Inside Airbnb` , an open-source data tool providing web scraped Airbnb listing information by city.

```{r, echo = FALSE, results = 'hide', message = FALSE}
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
```
## Data Preprocessing

```{r}
df <- read.csv('detailed_listings.csv')
glimpse(df)
```

We can see that the data seems clean, but some columns need to have a different data type.

```{r}
df <- df %>% mutate(last_review = as.Date(last_review))
```

Checking for invalid values.

```{r}
df %>% summarise_all(list(invalid = ~ mean(is.na(.) || . == '')))
```
Most columns do not have invalid values. The columns like `neighbourhood_group` and `license` need to be removed. 

The columns like `number_of_reviews` and `last_review` are NA when `number_of_reviews` is zero, so this does not need to be addressed.

```{r}
df <- df %>% select(-neighbourhood_group_cleansed) %>% select(-bathrooms) %>% select(-calendar_updated) %>% select(-license)
```

```{r}
df %>% summarise_all(list(invalid = ~ mean(is.na(.) || . == '')))
```

select columns
```{r}
listed_vars <- c("id","name","host_id","host_name","neighbourhood_cleansed","latitude","longitude","room_type","price","minimum_nights",            #     "number_of_reviews","last_review","reviews_per_month","calculated_host_listings_count","availability_365",
            "number_of_reviews_ltm", "review_scores_rating", "review_scores_accuracy", "review_scores_cleanliness",
            "review_scores_checkin", "review_scores_communication", "review_scores_location", "review_scores_value")

#listed_vars <- c("id","name","host_id","host_name","neighbourhood","latitude","longitude","room_type","price","minimum_nights",            #     "number_of_reviews","last_review","reviews_per_month","calculated_host_listings_count","availability_365",
#            "number_of_reviews_ltm", "review_scores_rating")

df <- df[listed_vars]
```

shift the types
```{r}
df$price = substring(df$price,2)
df <- df %>% mutate(price = gsub(",", "", price))
df$price = as.numeric(df$price)
df$room_type = as.factor(df$room_type)
df$neighbourhood_cleansed = as.factor(df$neighbourhood_cleansed)
```

Clean NA rows
```{r}
df = na.omit(df)
```


Structure of cleaned df
```{r}
str(df)
```

#General Summary of all airbnb prices, rating scores
#Check numbers of room types and neighbourhoods

```{r}
library(ezids)
xkablesummary(select(df, price, review_scores_rating))
summary(select(df, room_type))
summary(select(df, neighbourhood_cleansed))
```

#average price by room type
```{r}
price_room = df %>%
  group_by(room_type) %>%
  summarise_at(vars(price), list(price = mean))

price_room = data.frame(price_room)

price_room[order(-rank(price_room$price), decreasing = FALSE), ]
```
#average price by neighborhood
```{r}
price_neighbor = df %>%
  group_by(neighbourhood_cleansed) %>%
  summarise_at(vars(price), list(price = mean))

price_neighbor = data.frame(price_neighbor)

price_neighbor[order(-rank(price_neighbor$price), decreasing = FALSE), ]
```

#average rating score by neighborhood
```{r}
rating_neighbor = df %>%
  group_by(neighbourhood_cleansed) %>%
  summarise_at(vars(review_scores_rating), list(review_scores_rating = mean))

rating_neighbor = data.frame(rating_neighbor)
rating_neighbor
rating_neighbor[order(-rank(rating_neighbor$review_scores_rating), decreasing = FALSE), ]
```


#average location rating by neighborhood
```{r}
location_neighbor = df %>%
  group_by(neighbourhood_cleansed) %>%
  summarise_at(vars(review_scores_location), list(review_scores_location = mean))

location_neighbor = data.frame(location_neighbor)
location_neighbor[order(-rank(location_neighbor$review_scores_location), decreasing = FALSE), ]
```
“What DC neighborhood offers Airbnb listings with the highest ratings at the lowest price?”. The team will provide an overall neighborhood suggestion for where to book the best Airbnb deal in DC as well as by type (entire home, private room, etc) and budget.





```{R}
#ggplot(df,aes(x=longitude, y=latitude,fill=price)) + geom_tile(lwd = 10,linetype = 1) +labs(title="Price for different areas",x="Latitude", #y = "Longitude",col.main="orange") + scale_fill_gradient2(limits=c(0,1000))

ggplot(df, aes(df$longitude, df$latitude)) +
    geom_tile(aes(fill = df$price)) + 
    #geom_text(aes(label = round(value, 1))) +
    scale_fill_gradient(low = "white", high = "red") + scale_fill_gradient2(limits=c(0,1000))
```



```{r}
write.csv(df, "listings_with_reviews_price.csv")
```

